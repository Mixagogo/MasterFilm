<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Мастер-Фільм</title>
  <link href="TVstyle.css" rel="stylesheet">
	<script src="Filmscript.js"></script>
</head>

<header>
  <h1>Мастер-Фільм</h1>
  <h1>Онлайн ТВ</h1> 
  <div class = "menu">
    <ul>
      <a href="index.html">Головна</a>
      <a href="Series.html">Серіали</a>
      <a href="Films.html">Фільми</a>
      <a href="Shows.html">Мультфільми</a>
      <a href="onlineradio.html">Онлайн радіо</a>
      <a href="onlineTV.html">Онлайн ТВ</a>
    </ul>
  </div>  
</header>

<body>
  <div class="wrap">
    <div class="card" role="main">
      <div class="player" aria-label="HLS player">
        <video id="video" controls playsinline crossorigin="anonymous"></video>
      </div>

      <div class="controls">
        <select id="channelSelect">
          <option value="https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8">Тест 1</option>
          <option value="https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8">Тест 2</option>

        </select>

        <button id="loadBtn" class="btn">Відкрити</button>
        <button id="fullscreenBtn" class="btn secondary">Повний екран</button>
		    <button id="loadPlaylistBtn" class="btn secondary">Завантажити плейлист</button>
        <input type="file" id="playlistFile" accept=".m3u,.m3u8,.txt" style="display:none">
        <div class="status" id="status">Готово</div>
      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
const video = document.getElementById('video');
const channelSelect = document.getElementById('channelSelect');
const loadBtn = document.getElementById('loadBtn');
const fullscreenBtn = document.getElementById('fullscreenBtn');
const status = document.getElementById('status');
let hls = null;

function setStatus(t){ status.textContent=t; }

function unloadStream(){
  if(hls){ try{hls.destroy();}catch{} hls=null; }
  video.pause();
  video.removeAttribute('src');
  video.load();
}

function loadStream(url){
  unloadStream();
  setStatus("Завантаження...");

  if(Hls.isSupported()){
    hls=new Hls();
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED,function(){
      setStatus("Відтворюю");
      video.play().catch(()=>{});
    });
    hls.loadSource(url);
  } else if(video.canPlayType("application/vnd.apple.mpegurl")){
    video.src=url;
    video.onloadmetadata=()=>{ video.play(); };
  } else {
    setStatus("HLS не підтримується цим браузером.");
  }
}

loadBtn.onclick = () => loadStream(channelSelect.value);
window.onload = () => loadStream(channelSelect.value);

fullscreenBtn.onclick = ()=>{
  if(document.fullscreenElement) document.exitFullscreen();
  else document.documentElement.requestFullscreen();
};
const loadPlaylistBtn = document.getElementById('loadPlaylistBtn');
const playlistFile = document.getElementById('playlistFile');

loadPlaylistBtn.onclick = () => playlistFile.click();

playlistFile.addEventListener('change', function() {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        const text = e.target.result;
        parsePlaylist(text);
    };
    reader.readAsText(file);
});

function parsePlaylist(text) {
    let lines = text.split('\n').map(l => l.trim()).filter(l => l);

    let name = "";
    let url = "";

    for (let line of lines) {
        if (line.startsWith("#EXTINF")) {
            // Витягнути ім'я каналу
            let match = line.match(/,(.*)$/);
            name = match ? match[1].trim() : "Канал";
        } else if (line.startsWith("http") || line.startsWith("rtmp") || line.endsWith(".m3u8")) {
            url = line.trim();

            // Додати до випадаючого списку
            const option = document.createElement("option");
            option.value = url;
            option.textContent = name || url;

            channelSelect.appendChild(option);

            name = "";
            url = "";
        }
    }

    setStatus("Плейлист завантажено ✔");
}
</script>
</body>

<footer>
    

</footer>
</html>